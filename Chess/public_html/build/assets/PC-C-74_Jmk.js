import{j as k}from"./app-DI6LUIxo.js";class v{constructor(t,i,s){this.matrixPosition={x:t,y:i},this.white=s,this.taken=!1,this.hasMoved=!1}move(t,i){this.matrixPosition.x=t,this.matrixPosition.y=i,this.hasMoved=!0}clone(){const t=new this.constructor(this.matrixPosition.x,this.matrixPosition.y,this.white);return t.taken=this.taken,t.hasMoved=this.hasMoved,t}canMove(t,i,s){return!1}generateMoves(t){return[]}}const D="/build/assets/WhitePawn-DDSTqkDV.png",T="/build/assets/BlackPawn-CoKSC4Nu.png";class E extends v{canMove(t,i,s){const e=this.white?-1:1,n=this.white?6:1;if(t===this.matrixPosition.x&&i===this.matrixPosition.y+e&&!s.getPieceAt(t,i)||t===this.matrixPosition.x&&i===this.matrixPosition.y+2*e&&this.matrixPosition.y===n&&!s.getPieceAt(t,this.matrixPosition.y+e)&&!s.getPieceAt(t,i))return!0;if(Math.abs(t-this.matrixPosition.x)===1&&i===this.matrixPosition.y+e){const o=s.getPieceAt(t,i);return o&&o.white!==this.white}return!1}generateMoves(t){const i=[],s=this.white?-1:1;t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+s)||i.push({x:this.matrixPosition.x,y:this.matrixPosition.y+s});const e=this.white?6:1;this.matrixPosition.y===e&&!t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+s)&&!t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+2*s)&&i.push({x:this.matrixPosition.x,y:this.matrixPosition.y+2*s});for(let n of[-1,1]){const o=t.getPieceAt(this.matrixPosition.x+n,this.matrixPosition.y+s);o&&o.white!==this.white&&i.push({x:this.matrixPosition.x+n,y:this.matrixPosition.y+s})}return i}render(){return k.jsx("img",{src:this.white?D:T,alt:"Pawn",style:{width:"100%",height:"100%"}})}}const X="/build/assets/WhiteRook-Bzu2i_p0.png",_="/build/assets/BlackRook-BEU_bG0J.png";class g extends v{constructor(t,i,s){super(t,i,s),this.hasMoved=!1}canMove(t,i,s){if(t!==this.matrixPosition.x&&i!==this.matrixPosition.y)return!1;const e=t>this.matrixPosition.x?1:t<this.matrixPosition.x?-1:0,n=i>this.matrixPosition.y?1:i<this.matrixPosition.y?-1:0;let o=this.matrixPosition.x+e,a=this.matrixPosition.y+n;for(;o!==t||a!==i;){if(s.getPieceAt(o,a))return!1;o+=e,a+=n}const h=s.getPieceAt(t,i);return!h||h.white!==this.white}generateMoves(t){const i=[];return[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}].forEach(({dx:e,dy:n})=>{let o=this.matrixPosition.x+e,a=this.matrixPosition.y+n;for(;o>=0&&o<8&&a>=0&&a<8&&!t.getPieceAt(o,a);)i.push({x:o,y:a}),o+=e,a+=n;const h=t.getPieceAt(o,a);h&&h.white!==this.white&&i.push({x:o,y:a})}),i}render(){return k.jsx("img",{src:this.white?X:_,alt:"Rook",style:{width:"100%",height:"100%"}})}}const N="/build/assets/WhiteKnight-td7ohImi.png",F="/build/assets/BlackKnight-Bw5nkCIe.png";class q extends v{canMove(t,i,s){const e=Math.abs(this.matrixPosition.x-t),n=Math.abs(this.matrixPosition.y-i);return e===2&&n===1||e===1&&n===2}generateMoves(t){const i=[];return[{dx:2,dy:1},{dx:2,dy:-1},{dx:-2,dy:1},{dx:-2,dy:-1},{dx:1,dy:2},{dx:1,dy:-2},{dx:-1,dy:2},{dx:-1,dy:-2}].forEach(({dx:e,dy:n})=>{const o=this.matrixPosition.x+e,a=this.matrixPosition.y+n;if(o>=0&&o<8&&a>=0&&a<8){const h=t.getPieceAt(o,a);(!h||h.white!==this.white)&&i.push({x:o,y:a})}}),i}render(){return k.jsx("img",{src:this.white?N:F,alt:"Knight",style:{width:"100%",height:"100%"}})}}const O="/build/assets/WhiteBishop-BJRdsUrQ.png",Y="/build/assets/BlackBishop-Dg9iklNX.png";class w extends v{canMove(t,i,s){if(Math.abs(t-this.matrixPosition.x)!==Math.abs(i-this.matrixPosition.y))return!1;const e=t>this.matrixPosition.x?1:-1,n=i>this.matrixPosition.y?1:-1;let o=this.matrixPosition.x+e,a=this.matrixPosition.y+n;for(;o!==t||a!==i;){if(s.getPieceAt(o,a))return!1;o+=e,a+=n}const h=s.getPieceAt(t,i);return!h||h.white!==this.white}generateMoves(t){const i=[];return[{dx:1,dy:1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:-1,dy:-1}].forEach(({dx:e,dy:n})=>{let o=this.matrixPosition.x+e,a=this.matrixPosition.y+n;for(;o>=0&&o<8&&a>=0&&a<8&&!t.getPieceAt(o,a);)i.push({x:o,y:a}),o+=e,a+=n;const h=t.getPieceAt(o,a);h&&h.white!==this.white&&i.push({x:o,y:a})}),i}render(){return k.jsx("img",{src:this.white?O:Y,alt:"Bishop",style:{width:"100%",height:"100%"}})}}const J="/build/assets/WhiteQueen-JwNoHkfC.png",L="/build/assets/BlackQueen-CEOy94br.png";class S extends v{canMove(t,i,s){const e=new g(this.matrixPosition.x,this.matrixPosition.y,this.white).canMove(t,i,s),n=new w(this.matrixPosition.x,this.matrixPosition.y,this.white).canMove(t,i,s);return e||n}generateMoves(t){const i=new g(this.matrixPosition.x,this.matrixPosition.y,this.white).generateMoves(t),s=new w(this.matrixPosition.x,this.matrixPosition.y,this.white).generateMoves(t);return[...i,...s]}render(){return k.jsx("img",{src:this.white?J:L,alt:"Queen",style:{width:"100%",height:"100%"}})}}const U="/build/assets/WhiteKing-D-a6h-6i.png",V="/build/assets/BlackKing-ut6FM1LX.png";class y extends v{constructor(t,i,s){super(t,i,s),this.hasMoved=!1}canMove(t,i,s){const e=Math.abs(this.matrixPosition.x-t),n=Math.abs(this.matrixPosition.y-i);return e<=1&&n<=1||e===2&&n===0}generateMoves(t){const i=[];if([{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},{dx:1,dy:1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:-1,dy:-1}].forEach(({dx:e,dy:n})=>{const o=this.matrixPosition.x+e,a=this.matrixPosition.y+n;if(o>=0&&o<8&&a>=0&&a<8){const h=t.getPieceAt(o,a);(!h||h.white!==this.white)&&i.push({x:o,y:a})}}),!this.hasMoved&&!this.isSquareAttacked(this.matrixPosition.x,this.matrixPosition.y,t)){const e=this.matrixPosition.y;if(!t.getPieceAt(5,e)&&!t.getPieceAt(6,e)&&!this.isSquareAttacked(5,e,t)&&!this.isSquareAttacked(6,e,t)){const n=t.getPieceAt(7,e);n&&n.constructor.name==="Rook"&&!n.hasMoved&&i.push({x:6,y:e,castling:"kingside"})}if(!t.getPieceAt(1,e)&&!t.getPieceAt(2,e)&&!t.getPieceAt(3,e)&&!this.isSquareAttacked(2,e,t)&&!this.isSquareAttacked(3,e,t)){const n=t.getPieceAt(0,e);n&&n.constructor.name==="Rook"&&!n.hasMoved&&i.push({x:2,y:e,castling:"queenside"})}}return i}isSquareAttacked(t,i,s){return s.pieces.some(e=>{if(e.white===this.white||e.constructor.name==="King")return!1;if(e.constructor.name==="Pawn"){const n=e.white?-1:1;return t===e.matrixPosition.x-1&&i===e.matrixPosition.y+n||t===e.matrixPosition.x+1&&i===e.matrixPosition.y+n}return e.canMove(t,i,s)})}render(){return k.jsx("img",{src:this.white?U:V,alt:"King",style:{width:"100%",height:"100%"}})}}const G=(r,t)=>{const i=I(r,t);let s=!1;for(let e of i)if(j(r,e)!==r){s=!0;break}return s?!1:W(r,t)?"checkmate":"stalemate"},d=(r,t,i,s=-1/0,e=1/0)=>{const n=G(r,i);if(t===0||n)return n==="checkmate"?{evaluation:i?-1/0:1/0,move:null}:n==="stalemate"?{evaluation:0,move:null}:{evaluation:H(r),move:null};let o=null;if(i){let a=-1/0;const h=I(r,!0);for(let c of h){const M=r.getPieceAt(c.from.x,c.from.y);if(M instanceof E&&M.white&&c.to.y===0){let f=-1/0,A=null;for(let B of["queen","rook","bishop","knight"]){const x=r.clone(),u=x.getPieceAt(c.from.x,c.from.y),K=x.getPieceAt(c.to.x,c.to.y);K&&(x.pieces=x.pieces.filter(P=>P!==K)),x.pieces=x.pieces.filter(P=>P!==u);let l;switch(B){case"rook":l=new g(c.to.x,c.to.y,u.white);break;case"bishop":l=new w(c.to.x,c.to.y,u.white);break;case"knight":l=new q(c.to.x,c.to.y,u.white);break;default:l=new S(c.to.x,c.to.y,u.white)}x.pieces.push(l);const R=d(x,t-1,!1,s,e);if(R.evaluation>f&&(f=R.evaluation,A=B),s=Math.max(s,f),e<=s)break}f>a&&(a=f,o={...c,promotion:A});continue}const p=j(r,c);if(p===r)continue;const m=d(p,t-1,!1,s,e).evaluation;if(m>a&&(a=m,o=c),s=Math.max(s,m),e<=s)break}return o===null&&h.length>0&&(o=h[0]),{evaluation:a,move:o}}else{let a=1/0;const h=I(r,!1);for(let c of h){const M=r.getPieceAt(c.from.x,c.from.y);if(M instanceof E&&!M.white&&c.to.y===7){let f=1/0,A=null;for(let B of["queen","rook","bishop","knight"]){const x=r.clone(),u=x.getPieceAt(c.from.x,c.from.y),K=x.getPieceAt(c.to.x,c.to.y);K&&(x.pieces=x.pieces.filter(P=>P!==K)),x.pieces=x.pieces.filter(P=>P!==u);let l;switch(B){case"rook":l=new g(c.to.x,c.to.y,u.white);break;case"bishop":l=new w(c.to.x,c.to.y,u.white);break;case"knight":l=new q(c.to.x,c.to.y,u.white);break;default:l=new S(c.to.x,c.to.y,u.white)}x.pieces.push(l);const R=d(x,t-1,!0,s,e);if(R.evaluation<f&&(f=R.evaluation,A=B),e=Math.min(e,f),e<=s)break}f<a&&(a=f,o={...c,promotion:A});continue}const p=j(r,c);if(p===r)continue;const m=d(p,t-1,!0,s,e).evaluation;if(m<a&&(a=m,o=c),e=Math.min(e,m),e<=s)break}return o===null&&h.length>0&&(o=h[0]),{evaluation:a,move:o}}},I=(r,t)=>{const i=[];return r.pieces.forEach(s=>{if(s.white!==t)return;s.generateMoves(r).forEach(n=>{const o=r.getPieceAt(n.x,n.y);o&&o.white!==s.white?i.unshift({from:s.matrixPosition,to:n,capture:!0,value:C(o)}):i.push({from:s.matrixPosition,to:n,capture:!1})})}),i.sort((s,e)=>(e.value||0)-(s.value||0)),i},W=(r,t)=>{const i=r.pieces.find(e=>e instanceof y&&e.white===t);return i?I(r,!t).some(e=>e.to.x===i.matrixPosition.x&&e.to.y===i.matrixPosition.y):!1},j=(r,t)=>{if(!t||!t.from||!t.to)return r.clone();const i=r.clone(),s=i.getPieceAt(t.from.x,t.from.y);if(!s)return i;if(s instanceof E&&(s.white&&t.to.y===0||!s.white&&t.to.y===7)){const e=t.promotion?t.promotion.toLowerCase():"queen",n=i.getPieceAt(t.to.x,t.to.y);n&&n.white!==s.white&&(i.pieces=i.pieces.filter(a=>a!==n)),i.pieces=i.pieces.filter(a=>a!==s);let o;switch(e){case"rook":o=new g(t.to.x,t.to.y,s.white);break;case"bishop":o=new w(t.to.x,t.to.y,s.white);break;case"knight":o=new q(t.to.x,t.to.y,s.white);break;default:o=new S(t.to.x,t.to.y,s.white)}return i.pieces.push(o),W(i,s.white)?r:i}if(i.move(t.from,t.to),t.castling&&s.constructor.name==="King"){const e=t.to.y;if(t.castling==="kingside"){const n={x:7,y:e},o={x:5,y:e};i.move(n,o)}else if(t.castling==="queenside"){const n={x:0,y:e},o={x:3,y:e};i.move(n,o)}}return W(i,s.white)?r:i},H=r=>{let t=0;r.pieces.forEach(o=>{o.taken||(t+=o.white?C(o):-C(o),t+=o.white?Q(o):-Q(o))}),W(r,!0)&&(t-=.5),W(r,!1)&&(t+=.5);const i=r.pieces.filter(o=>o.white&&!(o instanceof y)),s=r.pieces.filter(o=>!o.white&&!(o instanceof y)),e=r.pieces.find(o=>o instanceof y&&o.white),n=r.pieces.find(o=>o instanceof y&&!o.white);if(e&&n){if(i.length===0&&s.length>0){const o=Math.abs(e.matrixPosition.x-n.matrixPosition.x),a=Math.abs(e.matrixPosition.y-n.matrixPosition.y),h=Math.max(o,a);t-=(7-h)*.5}if(s.length===0&&i.length>0){const o=Math.abs(e.matrixPosition.x-n.matrixPosition.x),a=Math.abs(e.matrixPosition.y-n.matrixPosition.y),h=Math.max(o,a);t+=(7-h)*.5}}return t},Q=r=>{const{x:t,y:i}=r.matrixPosition;let s=0;return(t===3||t===4)&&(i===3||i===4)&&(s+=1),(r instanceof q||r instanceof w)&&(s+=r.hasMoved?.5:-.5),r instanceof E&&(t===3||t===4)&&(s+=r.hasMoved?.3:-.3),r instanceof g&&(s+=r.hasMoved?.2:-.2),r instanceof S&&(s+=r.hasMoved?.1:-.1),s},C=r=>r instanceof E?1:r instanceof q||r instanceof w?3:r instanceof g?5:r instanceof S?9:r instanceof y?100:0,z=Object.freeze(Object.defineProperty({__proto__:null,applyMove:j,default:d,generateMovesForPlayer:I,runMinimax:d},Symbol.toStringTag,{value:"Module"}));export{w as B,q as K,E as P,S as Q,g as R,J as W,X as a,O as b,N as c,y as d,j as e,z as f,d as r};
