import{j as k}from"./app-DpKD5vfn.js";class M{constructor(t,e,o){this.matrixPosition={x:t,y:e},this.white=o,this.taken=!1,this.hasMoved=!1}move(t,e){this.matrixPosition.x=t,this.matrixPosition.y=e,this.hasMoved=!0}clone(){const t=new this.constructor(this.matrixPosition.x,this.matrixPosition.y,this.white);return t.taken=this.taken,t.hasMoved=this.hasMoved,t}canMove(t,e,o){return!1}generateMoves(t){return[]}}const D="/build/assets/WhitePawn-DDSTqkDV.png",T="/build/assets/BlackPawn-CoKSC4Nu.png";class E extends M{canMove(t,e,o){const s=this.white?-1:1,r=this.white?6:1;if(t===this.matrixPosition.x&&e===this.matrixPosition.y+s&&!o.getPieceAt(t,e)||t===this.matrixPosition.x&&e===this.matrixPosition.y+2*s&&this.matrixPosition.y===r&&!o.getPieceAt(t,this.matrixPosition.y+s)&&!o.getPieceAt(t,e))return!0;if(Math.abs(t-this.matrixPosition.x)===1&&e===this.matrixPosition.y+s){const i=o.getPieceAt(t,e);return i&&i.white!==this.white}return!1}generateMoves(t){const e=[],o=this.white?-1:1;t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+o)||e.push({x:this.matrixPosition.x,y:this.matrixPosition.y+o});const s=this.white?6:1;this.matrixPosition.y===s&&!t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+o)&&!t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+2*o)&&e.push({x:this.matrixPosition.x,y:this.matrixPosition.y+2*o});for(let r of[-1,1]){const i=t.getPieceAt(this.matrixPosition.x+r,this.matrixPosition.y+o);i&&i.white!==this.white&&e.push({x:this.matrixPosition.x+r,y:this.matrixPosition.y+o})}return e}render(){return k.jsx("img",{src:this.white?D:T,alt:"Pawn",style:{width:"100%",height:"100%"}})}}const X="/build/assets/WhiteRook-Bzu2i_p0.png",_="/build/assets/BlackRook-BEU_bG0J.png";class g extends M{canMove(t,e,o){if(t!==this.matrixPosition.x&&e!==this.matrixPosition.y)return!1;const s=t>this.matrixPosition.x?1:t<this.matrixPosition.x?-1:0,r=e>this.matrixPosition.y?1:e<this.matrixPosition.y?-1:0;let i=this.matrixPosition.x+s,a=this.matrixPosition.y+r;for(;i!==t||a!==e;){if(o.getPieceAt(i,a))return!1;i+=s,a+=r}const c=o.getPieceAt(t,e);return!c||c.white!==this.white}generateMoves(t){const e=[];return[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}].forEach(({dx:s,dy:r})=>{let i=this.matrixPosition.x+s,a=this.matrixPosition.y+r;for(;i>=0&&i<8&&a>=0&&a<8&&!t.getPieceAt(i,a);)e.push({x:i,y:a}),i+=s,a+=r;const c=t.getPieceAt(i,a);c&&c.white!==this.white&&e.push({x:i,y:a})}),e}render(){return k.jsx("img",{src:this.white?X:_,alt:"Rook",style:{width:"100%",height:"100%"}})}}const N="/build/assets/WhiteKnight-td7ohImi.png",F="/build/assets/BlackKnight-Bw5nkCIe.png";class q extends M{canMove(t,e,o){const s=Math.abs(this.matrixPosition.x-t),r=Math.abs(this.matrixPosition.y-e);return s===2&&r===1||s===1&&r===2}generateMoves(t){const e=[];return[{dx:2,dy:1},{dx:2,dy:-1},{dx:-2,dy:1},{dx:-2,dy:-1},{dx:1,dy:2},{dx:1,dy:-2},{dx:-1,dy:2},{dx:-1,dy:-2}].forEach(({dx:s,dy:r})=>{const i=this.matrixPosition.x+s,a=this.matrixPosition.y+r;if(i>=0&&i<8&&a>=0&&a<8){const c=t.getPieceAt(i,a);(!c||c.white!==this.white)&&e.push({x:i,y:a})}}),e}render(){return k.jsx("img",{src:this.white?N:F,alt:"Knight",style:{width:"100%",height:"100%"}})}}const O="/build/assets/WhiteBishop-BJRdsUrQ.png",Y="/build/assets/BlackBishop-Dg9iklNX.png";class w extends M{canMove(t,e,o){if(Math.abs(t-this.matrixPosition.x)!==Math.abs(e-this.matrixPosition.y))return!1;const s=t>this.matrixPosition.x?1:-1,r=e>this.matrixPosition.y?1:-1;let i=this.matrixPosition.x+s,a=this.matrixPosition.y+r;for(;i!==t||a!==e;){if(o.getPieceAt(i,a))return!1;i+=s,a+=r}const c=o.getPieceAt(t,e);return!c||c.white!==this.white}generateMoves(t){const e=[];return[{dx:1,dy:1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:-1,dy:-1}].forEach(({dx:s,dy:r})=>{let i=this.matrixPosition.x+s,a=this.matrixPosition.y+r;for(;i>=0&&i<8&&a>=0&&a<8&&!t.getPieceAt(i,a);)e.push({x:i,y:a}),i+=s,a+=r;const c=t.getPieceAt(i,a);c&&c.white!==this.white&&e.push({x:i,y:a})}),e}render(){return k.jsx("img",{src:this.white?O:Y,alt:"Bishop",style:{width:"100%",height:"100%"}})}}const J="/build/assets/WhiteQueen-JwNoHkfC.png",L="/build/assets/BlackQueen-CEOy94br.png";class S extends M{canMove(t,e,o){const s=new g(this.matrixPosition.x,this.matrixPosition.y,this.white).canMove(t,e,o),r=new w(this.matrixPosition.x,this.matrixPosition.y,this.white).canMove(t,e,o);return s||r}generateMoves(t){const e=new g(this.matrixPosition.x,this.matrixPosition.y,this.white).generateMoves(t),o=new w(this.matrixPosition.x,this.matrixPosition.y,this.white).generateMoves(t);return[...e,...o]}render(){return k.jsx("img",{src:this.white?J:L,alt:"Queen",style:{width:"100%",height:"100%"}})}}const b="/build/assets/WhiteKing-D-a6h-6i.png",U="/build/assets/BlackKing-ut6FM1LX.png";class y extends M{canMove(t,e,o){const s=Math.abs(this.matrixPosition.x-t),r=Math.abs(this.matrixPosition.y-e);return s<=1&&r<=1}isSquareAttacked(t,e,o){return o.pieces.some(s=>{if(s.white===this.white)return!1;if(s.constructor.name==="King"){const i=s.matrixPosition.x,a=s.matrixPosition.y;return Math.abs(i-t)<=1&&Math.abs(a-e)<=1}return s.generateMoves(o).some(i=>i.x===t&&i.y===e)})}generateMoves(t){const e=[];if([{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},{dx:1,dy:1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:-1,dy:-1}].forEach(({dx:s,dy:r})=>{const i=this.matrixPosition.x+s,a=this.matrixPosition.y+r;if(i>=0&&i<8&&a>=0&&a<8){const c=t.getPieceAt(i,a);(!c||c.white!==this.white)&&e.push({x:i,y:a})}}),!this.hasMoved&&!this.isSquareAttacked(this.matrixPosition.x,this.matrixPosition.y,t)){const s=this.matrixPosition.y,r=t.getPieceAt(7,s);r&&r.constructor.name==="Rook"&&r.white===this.white&&!r.hasMoved&&!t.getPieceAt(5,s)&&!t.getPieceAt(6,s)&&!this.isSquareAttacked(5,s,t)&&!this.isSquareAttacked(6,s,t)&&e.push({x:6,y:s,castling:"kingside"});const i=t.getPieceAt(0,s);i&&i.constructor.name==="Rook"&&i.white===this.white&&!i.hasMoved&&!t.getPieceAt(1,s)&&!t.getPieceAt(2,s)&&!t.getPieceAt(3,s)&&!this.isSquareAttacked(3,s,t)&&!this.isSquareAttacked(2,s,t)&&e.push({x:2,y:s,castling:"queenside"})}return e}render(){return k.jsx("img",{src:this.white?b:U,alt:"King",style:{width:"100%",height:"100%"}})}}const V=(n,t)=>{const e=I(n,t);let o=!1;for(let s of e)if(j(n,s)!==n){o=!0;break}return o?!1:W(n,t)?"checkmate":"stalemate"},d=(n,t,e,o=-1/0,s=1/0)=>{const r=V(n,e);if(t===0||r)return r==="checkmate"?{evaluation:e?-1/0:1/0,move:null}:r==="stalemate"?{evaluation:0,move:null}:{evaluation:G(n),move:null};let i=null;if(e){let a=-1/0;const c=I(n,!0);for(let h of c){const v=n.getPieceAt(h.from.x,h.from.y);if(v instanceof E&&v.white&&h.to.y===0){let f=-1/0,A=null;for(let B of["queen","rook","bishop","knight"]){const x=n.clone(),u=x.getPieceAt(h.from.x,h.from.y),K=x.getPieceAt(h.to.x,h.to.y);K&&(x.pieces=x.pieces.filter(P=>P!==K)),x.pieces=x.pieces.filter(P=>P!==u);let l;switch(B){case"rook":l=new g(h.to.x,h.to.y,u.white);break;case"bishop":l=new w(h.to.x,h.to.y,u.white);break;case"knight":l=new q(h.to.x,h.to.y,u.white);break;default:l=new S(h.to.x,h.to.y,u.white)}x.pieces.push(l);const R=d(x,t-1,!1,o,s);if(R.evaluation>f&&(f=R.evaluation,A=B),o=Math.max(o,f),s<=o)break}f>a&&(a=f,i={...h,promotion:A});continue}const p=j(n,h);if(p===n)continue;const m=d(p,t-1,!1,o,s).evaluation;if(m>a&&(a=m,i=h),o=Math.max(o,m),s<=o)break}return i===null&&c.length>0&&(i=c[0]),{evaluation:a,move:i}}else{let a=1/0;const c=I(n,!1);for(let h of c){const v=n.getPieceAt(h.from.x,h.from.y);if(v instanceof E&&!v.white&&h.to.y===7){let f=1/0,A=null;for(let B of["queen","rook","bishop","knight"]){const x=n.clone(),u=x.getPieceAt(h.from.x,h.from.y),K=x.getPieceAt(h.to.x,h.to.y);K&&(x.pieces=x.pieces.filter(P=>P!==K)),x.pieces=x.pieces.filter(P=>P!==u);let l;switch(B){case"rook":l=new g(h.to.x,h.to.y,u.white);break;case"bishop":l=new w(h.to.x,h.to.y,u.white);break;case"knight":l=new q(h.to.x,h.to.y,u.white);break;default:l=new S(h.to.x,h.to.y,u.white)}x.pieces.push(l);const R=d(x,t-1,!0,o,s);if(R.evaluation<f&&(f=R.evaluation,A=B),s=Math.min(s,f),s<=o)break}f<a&&(a=f,i={...h,promotion:A});continue}const p=j(n,h);if(p===n)continue;const m=d(p,t-1,!0,o,s).evaluation;if(m<a&&(a=m,i=h),s=Math.min(s,m),s<=o)break}return i===null&&c.length>0&&(i=c[0]),{evaluation:a,move:i}}},I=(n,t)=>{const e=[];return n.pieces.forEach(o=>{if(o.white!==t)return;o.generateMoves(n).forEach(r=>{const i=n.getPieceAt(r.x,r.y);i&&i.white!==o.white?e.unshift({from:o.matrixPosition,to:r,capture:!0,value:C(i)}):e.push({from:o.matrixPosition,to:r,capture:!1})})}),e.sort((o,s)=>(s.value||0)-(o.value||0)),e},W=(n,t)=>{const e=n.pieces.find(s=>s instanceof y&&s.white===t);return e?I(n,!t).some(s=>s.to.x===e.matrixPosition.x&&s.to.y===e.matrixPosition.y):!1},j=(n,t)=>{if(!t||!t.from||!t.to)return n.clone();const e=n.clone(),o=e.getPieceAt(t.from.x,t.from.y);if(!o)return e;if(o instanceof E&&(o.white&&t.to.y===0||!o.white&&t.to.y===7)){const s=t.promotion?t.promotion.toLowerCase():"queen",r=e.getPieceAt(t.to.x,t.to.y);r&&r.white!==o.white&&(e.pieces=e.pieces.filter(a=>a!==r)),e.pieces=e.pieces.filter(a=>a!==o);let i;switch(s){case"rook":i=new g(t.to.x,t.to.y,o.white);break;case"bishop":i=new w(t.to.x,t.to.y,o.white);break;case"knight":i=new q(t.to.x,t.to.y,o.white);break;default:i=new S(t.to.x,t.to.y,o.white)}return e.pieces.push(i),W(e,o.white)?n:e}if(e.move(t.from,t.to),t.castling&&o.constructor.name==="King"){const s=t.to.y;if(t.castling==="kingside"){const r={x:7,y:s},i={x:5,y:s};e.move(r,i)}else if(t.castling==="queenside"){const r={x:0,y:s},i={x:3,y:s};e.move(r,i)}}return W(e,o.white)?n:e},G=n=>{let t=0;n.pieces.forEach(i=>{i.taken||(t+=i.white?C(i):-C(i),t+=i.white?Q(i):-Q(i))}),W(n,!0)&&(t-=.5),W(n,!1)&&(t+=.5);const e=n.pieces.filter(i=>i.white&&!(i instanceof y)),o=n.pieces.filter(i=>!i.white&&!(i instanceof y)),s=n.pieces.find(i=>i instanceof y&&i.white),r=n.pieces.find(i=>i instanceof y&&!i.white);if(s&&r){if(e.length===0&&o.length>0){const i=Math.abs(s.matrixPosition.x-r.matrixPosition.x),a=Math.abs(s.matrixPosition.y-r.matrixPosition.y),c=Math.max(i,a);t-=(7-c)*.5}if(o.length===0&&e.length>0){const i=Math.abs(s.matrixPosition.x-r.matrixPosition.x),a=Math.abs(s.matrixPosition.y-r.matrixPosition.y),c=Math.max(i,a);t+=(7-c)*.5}}return t},Q=n=>{const{x:t,y:e}=n.matrixPosition;let o=0;return(t===3||t===4)&&(e===3||e===4)&&(o+=1),(n instanceof q||n instanceof w)&&(o+=n.hasMoved?.5:-.5),n instanceof E&&(t===3||t===4)&&(o+=n.hasMoved?.3:-.3),n instanceof g&&(o+=n.hasMoved?.2:-.2),n instanceof S&&(o+=n.hasMoved?.1:-.1),o},C=n=>n instanceof E?1:n instanceof q||n instanceof w?3:n instanceof g?5:n instanceof S?9:n instanceof y?100:0,z=Object.freeze(Object.defineProperty({__proto__:null,applyMove:j,default:d,generateMovesForPlayer:I,runMinimax:d},Symbol.toStringTag,{value:"Module"}));export{w as B,q as K,E as P,S as Q,g as R,J as W,X as a,O as b,N as c,j as d,y as e,z as f,d as r};
