import{r as g,j as u,a as ae}from"./app-BGr_wcTE.js";import{B as le,a as ce,b as ue,c as me,d as de,e as fe,f as he}from"./BlueKing-CbVvptcU.js";import{W as ge,a as xe,b as we,c as be,d as z,r as H,R as A,K as R,B as I,Q as D,e as O,P as c}from"./PC-C-jzJApB.js";const J={"images/blue_pawn.png":le,"images/blue_rook.png":ce,"images/blue_knight.png":ue,"images/blue_bishop.png":me,"images/blue_queen.png":de,"images/blue_king.png":fe},ve={Queen:ge,Rook:xe,Bishop:we,Knight:be},U=()=>{const r=[new A(0,0,!1),new R(1,0,!1),new I(2,0,!1),new D(3,0,!1),new O(4,0,!1),new I(5,0,!1),new R(6,0,!1),new A(7,0,!1),new c(0,1,!1),new c(1,1,!1),new c(2,1,!1),new c(3,1,!1),new c(4,1,!1),new c(5,1,!1),new c(6,1,!1),new c(7,1,!1),new c(0,6,!0),new c(1,6,!0),new c(2,6,!0),new c(3,6,!0),new c(4,6,!0),new c(5,6,!0),new c(6,6,!0),new c(7,6,!0),new A(0,7,!0),new R(1,7,!0),new I(2,7,!0),new D(3,7,!0),new O(4,7,!0),new I(5,7,!0),new R(6,7,!0),new A(7,7,!0)];return new he(r)},ke=(r,l)=>{const{x:i,y:d}=r.matrixPosition;switch(l.toLowerCase()){case"rook":return new A(i,d,r.white);case"bishop":return new I(i,d,r.white);case"knight":return new R(i,d,r.white);default:return new D(i,d,r.white)}},Q=(r,l)=>r.generateMoves(l).filter(i=>z(l,{from:r.matrixPosition,to:i})!==l),V=(r,l,i)=>i.some(d=>d.x===r&&d.y===l),pe=(r,l)=>{const i=String.fromCharCode(97+r),d=8-l;return i+d},W=(r,l,i)=>({Pawn:"",Knight:"n",Bishop:"b",Rook:"r",Queen:"q",King:"k"}[r.constructor.name]||"")+pe(l,i),Pe=({moveHistory:r,setMoveHistory:l,equippedSkinsMapping:i={}},d)=>{const[v,k]=g.useState(U()),[f,p]=g.useState(null),[X,P]=g.useState(!0),[b,x]=g.useState(null),[Y,E]=g.useState(0),[Z,$]=g.useState(!1),[j,T]=g.useState(null),G=g.useRef(null),C=g.useRef(null),ee=()=>{x("Black wins by resignation")};g.useImperativeHandle(d,()=>({retireGame:ee}));const te=()=>{let t="Win";b&&b.includes("Black wins")?t="Lose":b&&b.includes("Draw")&&(t="Draw"),ae.post("/game/result",{moves:r.map(e=>`${e.white} ${e.black}`).join(" | "),time:Y,side:"White",result:t}).then(()=>{$(!0)}).catch(()=>{})},ne=()=>{b&&!Z&&te(),k(U()),p(null),P(!0),x(null),l([]),G.current=null,C.current=null,E(0),$(!1)},se=t=>{if(!j)return;const{board:e,pawn:m}=j,a=ke(m,t);e.pieces=e.pieces.map(s=>s===m?a:s),k(e),T(null),p(null);const n=S(e,!1);if(n){x(n);return}P(!1),setTimeout(()=>{const w=H(e,3,!1).move;if(w){const K=e.getPieceAt(w.from.x,w.from.y),M=W(K,w.to.x,w.to.y),o=z(e,w);if(o!==e){k(o),l(y=>{const N=y.length-1,B={...y[N],black:M};return[...y.slice(0,N),B]});const h=S(o,!0);h&&x(h)}else x("Game over: AI resigns")}else x("Game over: AI resigns");P(!0)},500)},oe=(t,e)=>{if(b||j)return;const m=f?Q(f,v):[];if(f&&V(t,e,m)){const n=Date.now();if(!G.current)G.current=n,C.current=n;else{const o=n-C.current;E(h=>h+o),C.current=n}const s=v.clone(),w=W(f,t,e);l(o=>[...o,{white:w,black:""}]);const K=m.find(o=>o.x===t&&o.y===e);if(K.castling==="kingside"?(s.move(f.matrixPosition,{x:6,y:e}),s.getPieceAt(7,e)&&s.move({x:7,y:e},{x:5,y:e})):K.castling==="queenside"?(s.move(f.matrixPosition,{x:2,y:e}),s.getPieceAt(0,e)&&s.move({x:0,y:e},{x:3,y:e})):s.move(f.matrixPosition,{x:t,y:e}),f.constructor.name==="Pawn"){const o=s.getPieceAt(t,e);if(o.white&&o.matrixPosition.y===0||!o.white&&o.matrixPosition.y===7){T({board:s,pawn:o});return}}k(s),p(null);const M=S(s,!1);if(M){x(M);return}P(!1),setTimeout(()=>{const h=H(s,3,!1).move;if(h){const y=s.getPieceAt(h.from.x,h.from.y),N=W(y,h.to.x,h.to.y),B=z(s,h);if(B!==s){k(B),l(_=>{const F=_.length-1,ie={..._[F],black:N};return[..._.slice(0,F),ie]});const L=S(B,!0);L&&x(L)}else x("Game over: AI resigns")}else x("Game over: AI resigns");P(!0)},500);return}const a=v.getPieceAt(t,e);a&&a.white===X?p(a):p(null)},S=(t,e)=>{let m=[];return t.pieces.forEach(a=>{a.white===e&&(m=m.concat(Q(a,t)))}),m.length===0?q(t,e)?e?"Black wins by checkmate":"White wins by checkmate":"Draw by stalemate":null},q=(t,e)=>{const m=t.pieces.find(n=>n.constructor.name==="King"&&n.white===e);if(!m)return!1;let a=[];return t.pieces.forEach(n=>{n.white!==e&&(a=a.concat(n.generateMoves(t)))}),a.some(n=>n.x===m.matrixPosition.x&&n.y===m.matrixPosition.y)},re=f?Q(f,v):[];return u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsx("div",{className:"chessboard",children:Array(8).fill().map((t,e)=>Array(8).fill().map((m,a)=>u.jsxs("div",{className:`square ${(e+a)%2===0?"light":"dark"}`,onClick:()=>oe(a,e),children:[V(a,e,re)&&u.jsx("div",{style:{position:"absolute",width:"20px",height:"20px",backgroundColor:"rgba(0,255,0,0.4)",borderRadius:"50%",zIndex:1}}),v.pieces.map((n,s)=>{if(n&&n.matrixPosition.x===a&&n.matrixPosition.y===e){const w=n.constructor.name==="King"&&q(v,n.white);return u.jsxs("span",{className:"piece",style:{position:"relative",zIndex:2,border:f===n?"2px solid yellow":"none",borderRadius:"50%"},children:[w&&u.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"2px solid red",borderRadius:"50%",boxSizing:"border-box",pointerEvents:"none",zIndex:3}}),n.white&&i[n.constructor.name]?u.jsx("img",{src:J[i[n.constructor.name]],alt:n.constructor.name,style:{width:"100%",height:"100%"}}):n.render()]},s)}return null})]},`square-${e}-${a}`)))}),j&&u.jsx("div",{className:"promotion-modal",style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(46, 46, 46, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},children:u.jsx("div",{className:"promotion-container",style:{backgroundColor:"rgba(46, 46, 46, 0.9)",padding:"20px",borderRadius:"8px",display:"flex",gap:"10px"},children:["Queen","Rook","Bishop","Knight"].map(t=>{const e=i&&i[t]?J[i[t]]:ve[t];return u.jsx("img",{src:e,alt:t,style:{width:"50px",height:"50px",cursor:"pointer",border:"2px solid transparent"},onClick:()=>se(t)},t)})})}),b&&u.jsx("div",{className:"modal",children:u.jsxs("div",{className:"modal-content",children:[u.jsx("h2",{children:b}),u.jsx("div",{className:"modal-buttons",style:{marginTop:"20px"},children:u.jsx("button",{onClick:ne,children:"Restart"})})]})})]})},Re=g.forwardRef(Pe);export{Re as default};
