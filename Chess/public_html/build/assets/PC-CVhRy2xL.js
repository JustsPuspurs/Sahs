var T=Object.defineProperty;var S=(n,t,i)=>t in n?T(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var y=(n,t,i)=>S(n,typeof t!="symbol"?t+"":t,i);import{j as A}from"./app-C5tCblZg.js";class B{constructor(t,i,s){this.matrixPosition={x:t,y:i},this.white=s,this.taken=!1,this.hasMoved=!1}move(t,i){this.matrixPosition.x=t,this.matrixPosition.y=i,this.hasMoved=!0}clone(){const t=new this.constructor(this.matrixPosition.x,this.matrixPosition.y,this.white);return t.taken=this.taken,t.hasMoved=this.hasMoved,t}canMove(t,i,s){return!1}generateMoves(t){return[]}}const X="/build/assets/WhitePawn-DDSTqkDV.png",_="/build/assets/BlackPawn-CoKSC4Nu.png";class v extends B{canMove(t,i,s){const o=this.white?-1:1,r=this.white?6:1;if(t===this.matrixPosition.x&&i===this.matrixPosition.y+o&&!s.getPieceAt(t,i)||t===this.matrixPosition.x&&i===this.matrixPosition.y+2*o&&this.matrixPosition.y===r&&!s.getPieceAt(t,this.matrixPosition.y+o)&&!s.getPieceAt(t,i))return!0;if(Math.abs(t-this.matrixPosition.x)===1&&i===this.matrixPosition.y+o){const e=s.getPieceAt(t,i);return e&&e.white!==this.white}return!1}generateMoves(t){const i=[],s=this.white?-1:1;t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+s)||i.push({x:this.matrixPosition.x,y:this.matrixPosition.y+s});const o=this.white?6:1;this.matrixPosition.y===o&&!t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+s)&&!t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+2*s)&&i.push({x:this.matrixPosition.x,y:this.matrixPosition.y+2*s});for(let r of[-1,1]){const e=t.getPieceAt(this.matrixPosition.x+r,this.matrixPosition.y+s);e&&e.white!==this.white&&i.push({x:this.matrixPosition.x+r,y:this.matrixPosition.y+s})}return i}render(){return A.jsx("img",{src:this.white?X:_,alt:"Pawn",style:{width:"100%",height:"100%"}})}}y(v,"type","pawn");const N="/build/assets/WhiteRook-Bzu2i_p0.png",F="/build/assets/BlackRook-BEU_bG0J.png";class g extends B{canMove(t,i,s){if(t!==this.matrixPosition.x&&i!==this.matrixPosition.y)return!1;const o=t>this.matrixPosition.x?1:t<this.matrixPosition.x?-1:0,r=i>this.matrixPosition.y?1:i<this.matrixPosition.y?-1:0;let e=this.matrixPosition.x+o,a=this.matrixPosition.y+r;for(;e!==t||a!==i;){if(s.getPieceAt(e,a))return!1;e+=o,a+=r}const h=s.getPieceAt(t,i);return!h||h.white!==this.white}generateMoves(t){const i=[];return[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}].forEach(({dx:o,dy:r})=>{let e=this.matrixPosition.x+o,a=this.matrixPosition.y+r;for(;e>=0&&e<8&&a>=0&&a<8&&!t.getPieceAt(e,a);)i.push({x:e,y:a}),e+=o,a+=r;const h=t.getPieceAt(e,a);h&&h.white!==this.white&&i.push({x:e,y:a})}),i}render(){return A.jsx("img",{src:this.white?N:F,alt:"Rook",style:{width:"100%",height:"100%"}})}}y(g,"type","rook");const O="/build/assets/WhiteKnight-td7ohImi.png",Y="/build/assets/BlackKnight-Bw5nkCIe.png";class M extends B{canMove(t,i,s){const o=Math.abs(this.matrixPosition.x-t),r=Math.abs(this.matrixPosition.y-i);return o===2&&r===1||o===1&&r===2}generateMoves(t){const i=[];return[{dx:2,dy:1},{dx:2,dy:-1},{dx:-2,dy:1},{dx:-2,dy:-1},{dx:1,dy:2},{dx:1,dy:-2},{dx:-1,dy:2},{dx:-1,dy:-2}].forEach(({dx:o,dy:r})=>{const e=this.matrixPosition.x+o,a=this.matrixPosition.y+r;if(e>=0&&e<8&&a>=0&&a<8){const h=t.getPieceAt(e,a);(!h||h.white!==this.white)&&i.push({x:e,y:a})}}),i}render(){return A.jsx("img",{src:this.white?O:Y,alt:"Knight",style:{width:"100%",height:"100%"}})}}y(M,"type","knight");const J="/build/assets/WhiteBishop-BJRdsUrQ.png",L="/build/assets/BlackBishop-Dg9iklNX.png";class P extends B{canMove(t,i,s){if(Math.abs(t-this.matrixPosition.x)!==Math.abs(i-this.matrixPosition.y))return!1;const o=t>this.matrixPosition.x?1:-1,r=i>this.matrixPosition.y?1:-1;let e=this.matrixPosition.x+o,a=this.matrixPosition.y+r;for(;e!==t||a!==i;){if(s.getPieceAt(e,a))return!1;e+=o,a+=r}const h=s.getPieceAt(t,i);return!h||h.white!==this.white}generateMoves(t){const i=[];return[{dx:1,dy:1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:-1,dy:-1}].forEach(({dx:o,dy:r})=>{let e=this.matrixPosition.x+o,a=this.matrixPosition.y+r;for(;e>=0&&e<8&&a>=0&&a<8&&!t.getPieceAt(e,a);)i.push({x:e,y:a}),e+=o,a+=r;const h=t.getPieceAt(e,a);h&&h.white!==this.white&&i.push({x:e,y:a})}),i}render(){return A.jsx("img",{src:this.white?J:L,alt:"Bishop",style:{width:"100%",height:"100%"}})}}y(P,"type","bishop");const U="/build/assets/WhiteQueen-JwNoHkfC.png",V="/build/assets/BlackQueen-CEOy94br.png";class p extends B{canMove(t,i,s){const o=new g(this.matrixPosition.x,this.matrixPosition.y,this.white).canMove(t,i,s),r=new P(this.matrixPosition.x,this.matrixPosition.y,this.white).canMove(t,i,s);return o||r}generateMoves(t){const i=new g(this.matrixPosition.x,this.matrixPosition.y,this.white).generateMoves(t),s=new P(this.matrixPosition.x,this.matrixPosition.y,this.white).generateMoves(t);return[...i,...s]}render(){return A.jsx("img",{src:this.white?U:V,alt:"Queen",style:{width:"100%",height:"100%"}})}}y(p,"type","queen");const G="/build/assets/WhiteKing-D-a6h-6i.png",H="/build/assets/BlackKing-ut6FM1LX.png";class d extends B{canMove(t,i,s){const o=Math.abs(this.matrixPosition.x-t),r=Math.abs(this.matrixPosition.y-i);return o<=1&&r<=1||o===2&&r===0}generateMoves(t){const i=[];if([{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},{dx:1,dy:1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:-1,dy:-1}].forEach(({dx:o,dy:r})=>{const e=this.matrixPosition.x+o,a=this.matrixPosition.y+r;if(e>=0&&e<8&&a>=0&&a<8){const h=t.getPieceAt(e,a);(!h||h.white!==this.white)&&i.push({x:e,y:a})}}),!this.hasMoved){const o=this.matrixPosition.y;if(!t.getPieceAt(5,o)&&!t.getPieceAt(6,o)){const r=t.getPieceAt(7,o);r&&r.white===this.white&&!r.hasMoved&&i.push({x:6,y:o,castling:"kingside"})}if(!t.getPieceAt(1,o)&&!t.getPieceAt(2,o)&&!t.getPieceAt(3,o)){const r=t.getPieceAt(0,o);r&&r.white===this.white&&!r.hasMoved&&i.push({x:2,y:o,castling:"queenside"})}}return i}render(){return A.jsx("img",{src:this.white?G:H,alt:"King",style:{width:"100%",height:"100%"}})}}y(d,"type","king");const z=(n,t)=>{const i=C(n,t);let s=!1;for(let o of i)if(b(n,o)!==n){s=!0;break}return s?!1:q(n,t)?"checkmate":"stalemate"},k=(n,t,i,s=-1/0,o=1/0)=>{const r=z(n,i);if(t===0||r)return r==="checkmate"?{evaluation:i?-1/0:1/0,move:null}:r==="stalemate"?{evaluation:0,move:null}:{evaluation:Z(n),move:null};let e=null;if(i){let a=-1/0;const h=C(n,!0);for(let c of h){const K=n.getPieceAt(c.from.x,c.from.y);if(K instanceof v&&K.white&&c.to.y===0){let f=-1/0,R=null;for(let I of["queen","rook","bishop","knight"]){const x=n.clone(),l=x.getPieceAt(c.from.x,c.from.y),W=x.getPieceAt(c.to.x,c.to.y);W&&(x.pieces=x.pieces.filter(w=>w!==W)),x.pieces=x.pieces.filter(w=>w!==l);let u;switch(I){case"rook":u=new g(c.to.x,c.to.y,l.white);break;case"bishop":u=new P(c.to.x,c.to.y,l.white);break;case"knight":u=new M(c.to.x,c.to.y,l.white);break;default:u=new p(c.to.x,c.to.y,l.white)}x.pieces.push(u);const j=k(x,t-1,!1,s,o);if(j.evaluation>f&&(f=j.evaluation,R=I),s=Math.max(s,f),o<=s)break}f>a&&(a=f,e={...c,promotion:R});continue}const E=b(n,c);if(E===n)continue;const m=k(E,t-1,!1,s,o).evaluation;if(m>a&&(a=m,e=c),s=Math.max(s,m),o<=s)break}return e===null&&h.length>0&&(e=h[0]),{evaluation:a,move:e}}else{let a=1/0;const h=C(n,!1);for(let c of h){const K=n.getPieceAt(c.from.x,c.from.y);if(K instanceof v&&!K.white&&c.to.y===7){let f=1/0,R=null;for(let I of["queen","rook","bishop","knight"]){const x=n.clone(),l=x.getPieceAt(c.from.x,c.from.y),W=x.getPieceAt(c.to.x,c.to.y);W&&(x.pieces=x.pieces.filter(w=>w!==W)),x.pieces=x.pieces.filter(w=>w!==l);let u;switch(I){case"rook":u=new g(c.to.x,c.to.y,l.white);break;case"bishop":u=new P(c.to.x,c.to.y,l.white);break;case"knight":u=new M(c.to.x,c.to.y,l.white);break;default:u=new p(c.to.x,c.to.y,l.white)}x.pieces.push(u);const j=k(x,t-1,!0,s,o);if(j.evaluation<f&&(f=j.evaluation,R=I),o=Math.min(o,f),o<=s)break}f<a&&(a=f,e={...c,promotion:R});continue}const E=b(n,c);if(E===n)continue;const m=k(E,t-1,!0,s,o).evaluation;if(m<a&&(a=m,e=c),o=Math.min(o,m),o<=s)break}return e===null&&h.length>0&&(e=h[0]),{evaluation:a,move:e}}},C=(n,t)=>{const i=[];return n.pieces.forEach(s=>{if(s.white!==t)return;s.generateMoves(n).forEach(r=>{const e=n.getPieceAt(r.x,r.y);e&&e.white!==s.white?i.unshift({from:s.matrixPosition,to:r,capture:!0,value:D(e)}):i.push({from:s.matrixPosition,to:r,capture:!1})})}),i.sort((s,o)=>(o.value||0)-(s.value||0)),i},q=(n,t)=>{const i=n.pieces.find(o=>o instanceof d&&o.white===t);return i?C(n,!t).some(o=>o.to.x===i.matrixPosition.x&&o.to.y===i.matrixPosition.y):!1},b=(n,t)=>{if(!t||!t.from||!t.to)return n.clone();const i=n.clone(),s=i.getPieceAt(t.from.x,t.from.y);if(!s)return i;if(s instanceof v&&(s.white&&t.to.y===0||!s.white&&t.to.y===7)){const o=t.promotion?t.promotion.toLowerCase():"queen",r=i.getPieceAt(t.to.x,t.to.y);r&&r.white!==s.white&&(i.pieces=i.pieces.filter(a=>a!==r)),i.pieces=i.pieces.filter(a=>a!==s);let e;switch(o){case"rook":e=new g(t.to.x,t.to.y,s.white);break;case"bishop":e=new P(t.to.x,t.to.y,s.white);break;case"knight":e=new M(t.to.x,t.to.y,s.white);break;default:e=new p(t.to.x,t.to.y,s.white)}return i.pieces.push(e),q(i,s.white)?n:i}if(i.move(t.from,t.to),t.castling&&s.constructor.name==="King"){const o=t.to.y;if(t.castling==="kingside"){const r={x:7,y:o},e={x:5,y:o};i.move(r,e)}else if(t.castling==="queenside"){const r={x:0,y:o},e={x:3,y:o};i.move(r,e)}}return q(i,s.white)?n:i},Z=n=>{let t=0;n.pieces.forEach(e=>{e.taken||(t+=e.white?D(e):-D(e),t+=e.white?Q(e):-Q(e))}),q(n,!0)&&(t-=.5),q(n,!1)&&(t+=.5);const i=n.pieces.filter(e=>e.white&&!(e instanceof d)),s=n.pieces.filter(e=>!e.white&&!(e instanceof d)),o=n.pieces.find(e=>e instanceof d&&e.white),r=n.pieces.find(e=>e instanceof d&&!e.white);if(o&&r){if(i.length===0&&s.length>0){const e=Math.abs(o.matrixPosition.x-r.matrixPosition.x),a=Math.abs(o.matrixPosition.y-r.matrixPosition.y),h=Math.max(e,a);t-=(7-h)*.5}if(s.length===0&&i.length>0){const e=Math.abs(o.matrixPosition.x-r.matrixPosition.x),a=Math.abs(o.matrixPosition.y-r.matrixPosition.y),h=Math.max(e,a);t+=(7-h)*.5}}return t},Q=n=>{const{x:t,y:i}=n.matrixPosition;let s=0;return(t===3||t===4)&&(i===3||i===4)&&(s+=1),(n instanceof M||n instanceof P)&&(s+=n.hasMoved?.5:-.5),n instanceof v&&(t===3||t===4)&&(s+=n.hasMoved?.3:-.3),n instanceof g&&(s+=n.hasMoved?.2:-.2),n instanceof p&&(s+=n.hasMoved?.1:-.1),s},D=n=>n instanceof v?1:n instanceof M||n instanceof P?3:n instanceof g?5:n instanceof p?9:n instanceof d?100:0,it=Object.freeze(Object.defineProperty({__proto__:null,applyMove:b,default:k,generateMovesForPlayer:C,runMinimax:k},Symbol.toStringTag,{value:"Module"}));export{P as B,M as K,v as P,p as Q,g as R,O as W,J as a,N as b,U as c,d,b as e,it as f,k as r};
