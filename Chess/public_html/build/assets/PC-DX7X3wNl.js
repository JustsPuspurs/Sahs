import{j as M}from"./app-DmpkB3s6.js";class v{constructor(t,e,s){this.matrixPosition={x:t,y:e},this.white=s,this.taken=!1,this.hasMoved=!1}move(t,e){this.matrixPosition.x=t,this.matrixPosition.y=e,this.hasMoved=!0}clone(){const t=new this.constructor(this.matrixPosition.x,this.matrixPosition.y,this.white);return t.taken=this.taken,t.hasMoved=this.hasMoved,t}canMove(t,e,s){return!1}generateMoves(t){return[]}}const D="/build/assets/WhitePawn-DDSTqkDV.png",T="/build/assets/BlackPawn-CoKSC4Nu.png";class q extends v{canMove(t,e,s){const o=this.white?-1:1,a=this.white?6:1;if(t===this.matrixPosition.x&&e===this.matrixPosition.y+o&&!s.getPieceAt(t,e)||t===this.matrixPosition.x&&e===this.matrixPosition.y+2*o&&this.matrixPosition.y===a&&!s.getPieceAt(t,this.matrixPosition.y+o)&&!s.getPieceAt(t,e))return!0;if(Math.abs(t-this.matrixPosition.x)===1&&e===this.matrixPosition.y+o){const i=s.getPieceAt(t,e);return i&&i.white!==this.white}return!1}generateMoves(t){const e=[],s=this.white?-1:1;t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+s)||e.push({x:this.matrixPosition.x,y:this.matrixPosition.y+s});const o=this.white?6:1;this.matrixPosition.y===o&&!t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+s)&&!t.getPieceAt(this.matrixPosition.x,this.matrixPosition.y+2*s)&&e.push({x:this.matrixPosition.x,y:this.matrixPosition.y+2*s});for(let a of[-1,1]){const i=t.getPieceAt(this.matrixPosition.x+a,this.matrixPosition.y+s);i&&i.white!==this.white&&e.push({x:this.matrixPosition.x+a,y:this.matrixPosition.y+s})}return e}render(){return M.jsx("img",{src:this.white?D:T,alt:"Pawn",style:{width:"100%",height:"100%"}})}}const X="/build/assets/WhiteRook-Bzu2i_p0.png",N="/build/assets/BlackRook-BEU_bG0J.png";class m extends v{canMove(t,e,s){if(t!==this.matrixPosition.x&&e!==this.matrixPosition.y)return!1;const o=t>this.matrixPosition.x?1:t<this.matrixPosition.x?-1:0,a=e>this.matrixPosition.y?1:e<this.matrixPosition.y?-1:0;let i=this.matrixPosition.x+o,r=this.matrixPosition.y+a;for(;i!==t||r!==e;){if(s.getPieceAt(i,r))return!1;i+=o,r+=a}const h=s.getPieceAt(t,e);return!h||h.white!==this.white}generateMoves(t){const e=[];return[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}].forEach(({dx:o,dy:a})=>{let i=this.matrixPosition.x+o,r=this.matrixPosition.y+a;for(;i>=0&&i<8&&r>=0&&r<8&&!t.getPieceAt(i,r);)e.push({x:i,y:r}),i+=o,r+=a;const h=t.getPieceAt(i,r);h&&h.white!==this.white&&e.push({x:i,y:r})}),e}render(){return M.jsx("img",{src:this.white?X:N,alt:"Rook",style:{width:"100%",height:"100%"}})}}const _="/build/assets/WhiteKnight-td7ohImi.png",F="/build/assets/BlackKnight-Bw5nkCIe.png";class R extends v{canMove(t,e,s){const o=Math.abs(this.matrixPosition.x-t),a=Math.abs(this.matrixPosition.y-e);return o===2&&a===1||o===1&&a===2}generateMoves(t){const e=[];return[{dx:2,dy:1},{dx:2,dy:-1},{dx:-2,dy:1},{dx:-2,dy:-1},{dx:1,dy:2},{dx:1,dy:-2},{dx:-1,dy:2},{dx:-1,dy:-2}].forEach(({dx:o,dy:a})=>{const i=this.matrixPosition.x+o,r=this.matrixPosition.y+a;if(i>=0&&i<8&&r>=0&&r<8){const h=t.getPieceAt(i,r);(!h||h.white!==this.white)&&e.push({x:i,y:r})}}),e}render(){return M.jsx("img",{src:this.white?_:F,alt:"Knight",style:{width:"100%",height:"100%"}})}}const O="/build/assets/WhiteBishop-BJRdsUrQ.png",Y="/build/assets/BlackBishop-Dg9iklNX.png";class d extends v{canMove(t,e,s){if(Math.abs(t-this.matrixPosition.x)!==Math.abs(e-this.matrixPosition.y))return!1;const o=t>this.matrixPosition.x?1:-1,a=e>this.matrixPosition.y?1:-1;let i=this.matrixPosition.x+o,r=this.matrixPosition.y+a;for(;i!==t||r!==e;){if(s.getPieceAt(i,r))return!1;i+=o,r+=a}const h=s.getPieceAt(t,e);return!h||h.white!==this.white}generateMoves(t){const e=[];return[{dx:1,dy:1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:-1,dy:-1}].forEach(({dx:o,dy:a})=>{let i=this.matrixPosition.x+o,r=this.matrixPosition.y+a;for(;i>=0&&i<8&&r>=0&&r<8&&!t.getPieceAt(i,r);)e.push({x:i,y:r}),i+=o,r+=a;const h=t.getPieceAt(i,r);h&&h.white!==this.white&&e.push({x:i,y:r})}),e}render(){return M.jsx("img",{src:this.white?O:Y,alt:"Bishop",style:{width:"100%",height:"100%"}})}}const J="/build/assets/WhiteQueen-JwNoHkfC.png",L="/build/assets/BlackQueen-CEOy94br.png";class S extends v{canMove(t,e,s){const o=new m(this.matrixPosition.x,this.matrixPosition.y,this.white).canMove(t,e,s),a=new d(this.matrixPosition.x,this.matrixPosition.y,this.white).canMove(t,e,s);return o||a}generateMoves(t){const e=new m(this.matrixPosition.x,this.matrixPosition.y,this.white).generateMoves(t),s=new d(this.matrixPosition.x,this.matrixPosition.y,this.white).generateMoves(t);return[...e,...s]}render(){return M.jsx("img",{src:this.white?J:L,alt:"Queen",style:{width:"100%",height:"100%"}})}}const b="/build/assets/WhiteKing-D-a6h-6i.png",U="/build/assets/BlackKing-ut6FM1LX.png";class P extends v{canMove(t,e,s){const o=Math.abs(this.matrixPosition.x-t),a=Math.abs(this.matrixPosition.y-e);return o<=1&&a<=1}isSquareAttacked(t,e,s){return s.pieces.some(o=>{if(o.white===this.white)return!1;if(o instanceof P){const{x:i,y:r}=o.matrixPosition;return Math.abs(i-t)<=1&&Math.abs(r-e)<=1}return o.generateMoves(s).some(i=>i.x===t&&i.y===e)})}generateMoves(t){const e=[],{x:s,y:o}=this.matrixPosition;if([{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},{dx:1,dy:1},{dx:1,dy:-1},{dx:-1,dy:1},{dx:-1,dy:-1}].forEach(({dx:i,dy:r})=>{const h=s+i,c=o+r;if(h>=0&&h<8&&c>=0&&c<8){const g=t.getPieceAt(h,c);(!g||g.white!==this.white)&&e.push({x:h,y:c})}}),!this.hasMoved&&!this.isSquareAttacked(s,o,t)){const i=o,r=t.getPieceAt(7,i);r&&r instanceof m&&r.white===this.white&&!r.hasMoved&&!t.getPieceAt(5,i)&&!t.getPieceAt(6,i)&&!this.isSquareAttacked(5,i,t)&&!this.isSquareAttacked(6,i,t)&&e.push({x:6,y:i,castling:"kingside"});const h=t.getPieceAt(0,i);h&&h instanceof m&&h.white===this.white&&!h.hasMoved&&!t.getPieceAt(1,i)&&!t.getPieceAt(2,i)&&!t.getPieceAt(3,i)&&!this.isSquareAttacked(3,i,t)&&!this.isSquareAttacked(2,i,t)&&e.push({x:2,y:i,castling:"queenside"})}return e}render(){return M.jsx("img",{src:this.white?b:U,alt:"King",style:{width:"100%",height:"100%"}})}}const V=(n,t)=>{const e=I(n,t);let s=!1;for(let o of e)if(j(n,o)!==n){s=!0;break}return s?!1:W(n,t)?"checkmate":"stalemate"},k=(n,t,e,s=-1/0,o=1/0)=>{const a=V(n,e);if(t===0||a)return a==="checkmate"?{evaluation:e?-1/0:1/0,move:null}:a==="stalemate"?{evaluation:0,move:null}:{evaluation:G(n),move:null};let i=null;if(e){let r=-1/0;const h=I(n,!0);for(let c of h){const g=n.getPieceAt(c.from.x,c.from.y);if(g instanceof q&&g.white&&c.to.y===0){let f=-1/0,A=null;for(let B of["queen","rook","bishop","knight"]){const x=n.clone(),l=x.getPieceAt(c.from.x,c.from.y),K=x.getPieceAt(c.to.x,c.to.y);K&&(x.pieces=x.pieces.filter(y=>y!==K)),x.pieces=x.pieces.filter(y=>y!==l);let u;switch(B){case"rook":u=new m(c.to.x,c.to.y,l.white);break;case"bishop":u=new d(c.to.x,c.to.y,l.white);break;case"knight":u=new R(c.to.x,c.to.y,l.white);break;default:u=new S(c.to.x,c.to.y,l.white)}x.pieces.push(u);const E=k(x,t-1,!1,s,o);if(E.evaluation>f&&(f=E.evaluation,A=B),s=Math.max(s,f),o<=s)break}f>r&&(r=f,i={...c,promotion:A});continue}const p=j(n,c);if(p===n)continue;const w=k(p,t-1,!1,s,o).evaluation;if(w>r&&(r=w,i=c),s=Math.max(s,w),o<=s)break}return i===null&&h.length>0&&(i=h[0]),{evaluation:r,move:i}}else{let r=1/0;const h=I(n,!1);for(let c of h){const g=n.getPieceAt(c.from.x,c.from.y);if(g instanceof q&&!g.white&&c.to.y===7){let f=1/0,A=null;for(let B of["queen","rook","bishop","knight"]){const x=n.clone(),l=x.getPieceAt(c.from.x,c.from.y),K=x.getPieceAt(c.to.x,c.to.y);K&&(x.pieces=x.pieces.filter(y=>y!==K)),x.pieces=x.pieces.filter(y=>y!==l);let u;switch(B){case"rook":u=new m(c.to.x,c.to.y,l.white);break;case"bishop":u=new d(c.to.x,c.to.y,l.white);break;case"knight":u=new R(c.to.x,c.to.y,l.white);break;default:u=new S(c.to.x,c.to.y,l.white)}x.pieces.push(u);const E=k(x,t-1,!0,s,o);if(E.evaluation<f&&(f=E.evaluation,A=B),o=Math.min(o,f),o<=s)break}f<r&&(r=f,i={...c,promotion:A});continue}const p=j(n,c);if(p===n)continue;const w=k(p,t-1,!0,s,o).evaluation;if(w<r&&(r=w,i=c),o=Math.min(o,w),o<=s)break}return i===null&&h.length>0&&(i=h[0]),{evaluation:r,move:i}}},I=(n,t)=>{const e=[];return n.pieces.forEach(s=>{if(s.white!==t)return;s.generateMoves(n).forEach(a=>{const i=n.getPieceAt(a.x,a.y);i&&i.white!==s.white?e.unshift({from:s.matrixPosition,to:a,capture:!0,value:C(i)}):e.push({from:s.matrixPosition,to:a,capture:!1})})}),e.sort((s,o)=>(o.value||0)-(s.value||0)),e},W=(n,t)=>{const e=n.pieces.find(o=>o instanceof P&&o.white===t);return e?I(n,!t).some(o=>o.to.x===e.matrixPosition.x&&o.to.y===e.matrixPosition.y):!1},j=(n,t)=>{if(!t||!t.from||!t.to)return n.clone();const e=n.clone(),s=e.getPieceAt(t.from.x,t.from.y);if(!s)return e;if(s instanceof q&&(s.white&&t.to.y===0||!s.white&&t.to.y===7)){const o=t.promotion?t.promotion.toLowerCase():"queen",a=e.getPieceAt(t.to.x,t.to.y);a&&a.white!==s.white&&(e.pieces=e.pieces.filter(r=>r!==a)),e.pieces=e.pieces.filter(r=>r!==s);let i;switch(o){case"rook":i=new m(t.to.x,t.to.y,s.white);break;case"bishop":i=new d(t.to.x,t.to.y,s.white);break;case"knight":i=new R(t.to.x,t.to.y,s.white);break;default:i=new S(t.to.x,t.to.y,s.white)}return e.pieces.push(i),W(e,s.white)?n:e}if(e.move(t.from,t.to),t.castling&&s.constructor.name==="King"){const o=t.to.y;if(t.castling==="kingside"){const a={x:7,y:o},i={x:5,y:o};e.move(a,i)}else if(t.castling==="queenside"){const a={x:0,y:o},i={x:3,y:o};e.move(a,i)}}return W(e,s.white)?n:e},G=n=>{let t=0;n.pieces.forEach(i=>{i.taken||(t+=i.white?C(i):-C(i),t+=i.white?Q(i):-Q(i))}),W(n,!0)&&(t-=.5),W(n,!1)&&(t+=.5);const e=n.pieces.filter(i=>i.white&&!(i instanceof P)),s=n.pieces.filter(i=>!i.white&&!(i instanceof P)),o=n.pieces.find(i=>i instanceof P&&i.white),a=n.pieces.find(i=>i instanceof P&&!i.white);if(o&&a){if(e.length===0&&s.length>0){const i=Math.abs(o.matrixPosition.x-a.matrixPosition.x),r=Math.abs(o.matrixPosition.y-a.matrixPosition.y),h=Math.max(i,r);t-=(7-h)*.5}if(s.length===0&&e.length>0){const i=Math.abs(o.matrixPosition.x-a.matrixPosition.x),r=Math.abs(o.matrixPosition.y-a.matrixPosition.y),h=Math.max(i,r);t+=(7-h)*.5}}return t},Q=n=>{const{x:t,y:e}=n.matrixPosition;let s=0;return(t===3||t===4)&&(e===3||e===4)&&(s+=1),(n instanceof R||n instanceof d)&&(s+=n.hasMoved?.5:-.5),n instanceof q&&(t===3||t===4)&&(s+=n.hasMoved?.3:-.3),n instanceof m&&(s+=n.hasMoved?.2:-.2),n instanceof S&&(s+=n.hasMoved?.1:-.1),s},C=n=>n instanceof q?1:n instanceof R||n instanceof d?3:n instanceof m?5:n instanceof S?9:n instanceof P?100:0,z=Object.freeze(Object.defineProperty({__proto__:null,applyMove:j,default:k,generateMovesForPlayer:I,runMinimax:k},Symbol.toStringTag,{value:"Module"}));export{d as B,R as K,q as P,S as Q,m as R,J as W,X as a,O as b,_ as c,j as d,P as e,z as f,k as r};
